# base


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## BaseJob Dataclass

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L42"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJob

>  BaseJob (id:str, plugin_id:str, status:str='pending',
>               created_at:str=<factory>, started_at:Optional[str]=None,
>               completed_at:Optional[str]=None,
>               result:Optional[Dict[str,Any]]=None, error:Optional[str]=None,
>               metadata:Dict[str,Any]=<factory>, worker_pid:Optional[int]=None)

*Base class for all job types.*

## BaseJobManager Class

The
[`BaseJobManager`](https://cj-mills.github.io/cjm-fasthtml-workers/managers/base.html#basejobmanager)
is an abstract base class that provides the core infrastructure for
managing background jobs with worker processes. It handles:

- Worker process lifecycle (start, restart, shutdown)
- Job queuing and execution
- Result monitoring
- Resource management integration (optional)
- Event broadcasting (optional)

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L59"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager

>  BaseJobManager (worker_type:str, category:Any,
>                      supports_streaming:bool=False, worker_config:Optional[cjm
>                      _fasthtml_workers.core.config.WorkerConfig]=None, plugin_
>                      registry:Optional[cjm_fasthtml_workers.extensions.protoco
>                      ls.PluginRegistryProtocol]=None, resource_manager:Optiona
>                      l[cjm_fasthtml_workers.extensions.protocols.ResourceManag
>                      erProtocol]=None, event_broadcaster:Optional[cjm_fasthtml
>                      _workers.extensions.protocols.EventBroadcasterProtocol]=N
>                      one)

\*Abstract base class for managing jobs using worker processes.

Features: - Jobs processed sequentially in subprocess - Plugin resources
loaded once and reused - True cancellation via subprocess termination -
Automatic worker restart based on policy - Isolated worker process
avoids duplicating web app initialization - Optional streaming support
for incremental results - Optional dependency injection for plugin
registry, resource manager, and event broadcaster\*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>worker_type</td>
<td>str</td>
<td></td>
<td>Type identifier (e.g., “transcription”, “llm”, “image-gen”)</td>
</tr>
<tr>
<td>category</td>
<td>Any</td>
<td></td>
<td>Plugin category this manager handles</td>
</tr>
<tr>
<td>supports_streaming</td>
<td>bool</td>
<td>False</td>
<td>Whether this manager supports streaming jobs</td>
</tr>
<tr>
<td>worker_config</td>
<td>Optional</td>
<td>None</td>
<td>Worker configuration (uses defaults if None)</td>
</tr>
<tr>
<td>plugin_registry</td>
<td>Optional</td>
<td>None</td>
<td>Optional plugin registry integration</td>
</tr>
<tr>
<td>resource_manager</td>
<td>Optional</td>
<td>None</td>
<td>Optional resource manager integration</td>
</tr>
<tr>
<td>event_broadcaster</td>
<td>Optional</td>
<td>None</td>
<td>Optional SSE event broadcaster</td>
</tr>
</tbody>
</table>

## Abstract Methods

Subclasses must implement these methods to customize job handling for
their specific use case.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L126"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.create_job

>  BaseJobManager.create_job (plugin_id:str, **kwargs)

*Factory method for creating domain-specific jobs.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>plugin_id</td>
<td>str</td>
<td>Plugin unique identifier</td>
</tr>
<tr>
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>JobType</strong></td>
<td><strong>Created job instance</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L137"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.get_worker_entry_point

>  BaseJobManager.get_worker_entry_point ()

*Return the worker process function for this manager.*

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L146"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.prepare_execute_request

>  BaseJobManager.prepare_execute_request (job:~JobType)

*Convert job to worker execute request parameters.*

<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 38%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>job</td>
<td>JobType</td>
<td>The job to prepare for execution</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Dict</strong></td>
<td><strong>Dictionary of parameters for the worker execute
request</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L156"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.extract_job_result

>  BaseJobManager.extract_job_result (job:~JobType,
>                                         result_data:Dict[str,Any])

*Extract and format job result from worker response.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>job</td>
<td>JobType</td>
<td>The job that was executed</td>
</tr>
<tr>
<td>result_data</td>
<td>Dict</td>
<td>Raw result data from worker</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Dict</strong></td>
<td><strong>Formatted result for storage</strong></td>
</tr>
</tbody>
</table>

## Hook Methods

These methods provide extension points for subclasses to customize
behavior without overriding core functionality.

This hook extracts a plugin resource identifier from the plugin
configuration for resource tracking. The default implementation tries
common keys (`resource_id`, `model_id`, `model`, `model_name`) but
subclasses can override this to match their specific configuration
structure.

**Example override:**

``` python
def _extract_plugin_resource_identifier(self, config):
    # Custom logic for your plugin system
    return config.get('resource_path', 'unknown')
```

This hook allows you to implement custom validation before starting a
job. Return `None` if validation passes, or an error message string if
it fails.

**Example override:**

``` python
async def _validate_resources(self, plugin_id, plugin_config):
    # Check if another job is already running
    if self.worker_process and self.current_plugin_id:
        return "Another job is already running"
    
    # Check GPU availability
    if plugin_config.get('device') == 'cuda':
        if not torch.cuda.is_available():
            return "CUDA not available"
    
    return None  # Validation passed
```

This hook is called automatically when a job completes successfully. Use
it to implement post-processing logic like saving results, sending
notifications, or triggering follow-up tasks.

**Example override:**

``` python
def _on_job_completed(self, job_id):
    job = self.get_job(job_id)
    result = self.get_job_result(job_id)
    
    # Save result to disk
    output_path = f"results/{job_id}.json"
    with open(output_path, 'w') as f:
        json.dump(result, f)
    
    # Track completion count
    self.completed_count += 1
    
    print(f"Job {job_id} completed and saved to {output_path}")
```

## Worker Lifecycle Management

## Result Monitoring and Handling

## Plugin Management Methods

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L422"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.get_plugin_name

>  BaseJobManager.get_plugin_name (plugin_id:str)

*Get plugin name from plugin ID (requires plugin registry).*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>plugin_id</td>
<td>str</td>
<td>Plugin unique identifier</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td><strong>Plugin name or None</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L437"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.unload_plugin

>  BaseJobManager.unload_plugin (plugin_name:str)

*Unload a plugin from the worker to free resources.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>plugin_name</td>
<td>str</td>
<td>Name of the plugin to unload</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if successful, False otherwise</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L485"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.reload_plugin

>  BaseJobManager.reload_plugin (plugin_name:str, config:Dict[str,Any])

*Reload a plugin with new configuration.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>plugin_name</td>
<td>str</td>
<td>Name of the plugin to reload</td>
</tr>
<tr>
<td>config</td>
<td>Dict</td>
<td>New configuration</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if successful, False otherwise</strong></td>
</tr>
</tbody>
</table>

## Job Management Methods

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L554"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.start_job

>  BaseJobManager.start_job (plugin_id:str, **kwargs)

*Start a new job.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>plugin_id</td>
<td>str</td>
<td>Plugin unique identifier</td>
</tr>
<tr>
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>JobType</strong></td>
<td><strong>Created and started job</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L631"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.cancel_job

>  BaseJobManager.cancel_job (job_id:str)

*Cancel a running job by terminating the worker process.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>job_id</td>
<td>str</td>
<td>ID of the job to cancel</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if cancellation successful</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L685"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.get_job

>  BaseJobManager.get_job (job_id:str)

*Get a job by ID.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>job_id</td>
<td>str</td>
<td>Unique job identifier</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td><strong>Job object or None</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L694"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.get_all_jobs

>  BaseJobManager.get_all_jobs ()

*Get all jobs.*

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L702"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.get_job_result

>  BaseJobManager.get_job_result (job_id:str)

*Get job result.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>job_id</td>
<td>str</td>
<td>Unique job identifier</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td><strong>Job result or None</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L711"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.clear_completed_jobs

>  BaseJobManager.clear_completed_jobs ()

*Clear completed, failed, and cancelled jobs.*

## Utility Methods

## Usage Example

To use
[`BaseJobManager`](https://cj-mills.github.io/cjm-fasthtml-workers/managers/base.html#basejobmanager),
create a concrete subclass that implements the required abstract
methods. Here’s a minimal example structure:

``` python
from dataclasses import dataclass
from cjm_fasthtml_workers.managers.base import BaseJobManager, BaseJob

@dataclass
class MyJob(BaseJob):
    """Custom job type with domain-specific fields."""
    input_text: str = ""
    
class MyJobManager(BaseJobManager[MyJob]):
    """Concrete job manager implementation."""
    
    def create_job(self, plugin_id: str, **kwargs) -> MyJob:
        """Create a job instance."""
        return MyJob(
            id=str(uuid.uuid4()),
            plugin_id=plugin_id,
            input_text=kwargs.get('input_text', '')
        )
    
    def get_worker_entry_point(self) -> Callable:
        """Return the worker function."""
        return my_worker_process
    
    def prepare_execute_request(self, job: MyJob) -> Dict[str, Any]:
        """Convert job to execution parameters."""
        return {'text': job.input_text}
    
    def extract_job_result(self, job: MyJob, result_data: Dict[str, Any]) -> Dict[str, Any]:
        """Format the result."""
        return result_data

# Create and use the manager
manager = MyJobManager(
    worker_type="text_processing",
    category="processing",
    worker_config=WorkerConfig()
)

# Start a job
job = await manager.start_job(plugin_id="my-plugin", input_text="Hello World")
```

For a complete working example, see the `demo_app.py` file in the
repository.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L731"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.broadcast_event

>  BaseJobManager.broadcast_event (event_type:str, data:Dict[str,Any])

*Broadcast an event to all connected SSE clients (requires event
broadcaster).*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>event_type</td>
<td>str</td>
<td>Event type identifier</td>
</tr>
<tr>
<td>data</td>
<td>Dict</td>
<td>Event data payload</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L742"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.check_streaming_support

>  BaseJobManager.check_streaming_support (plugin_id:str)

*Check if a plugin supports streaming.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>plugin_id</td>
<td>str</td>
<td>Plugin unique identifier</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if streaming supported</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/managers/base.py#L753"
target="_blank" style="float:right; font-size:smaller">source</a>

### BaseJobManager.shutdown

>  BaseJobManager.shutdown ()

*Shutdown the manager and cleanup resources.*
