# worker


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Worker Process

The
[`base_worker_process`](https://cj-mills.github.io/cjm-fasthtml-workers/core/worker.html#base_worker_process)
function is the entry point for worker subprocesses. It:

1.  Receives plugin configurations through an init message
2.  Creates a plugin manager instance (isolated from the main process)
3.  Loads configured plugins
4.  Processes job execution requests from the request queue
5.  Sends results back through the result queue
6.  Handles plugin reload/unload commands
7.  Supports streaming execution for incremental results

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-workers/blob/main/cjm_fasthtml_workers/core/worker.py#L20"
target="_blank" style="float:right; font-size:smaller">source</a>

### base_worker_process

>  base_worker_process (request_queue:<boundmethodBaseContext.Queueof<multip
>                           rocessing.context.DefaultContextobjectat0x7f1571404a
>                           90>>, result_queue:<boundmethodBaseContext.Queueof<m
>                           ultiprocessing.context.DefaultContextobjectat0x7f157
>                           1404a90>>, response_queue:<boundmethodBaseContext.Qu
>                           eueof<multiprocessing.context.DefaultContextobjectat
>                           0x7f1571404a90>>, plugin_manager_factory:Callable[[]
>                           ,cjm_fasthtml_workers.core.protocol.PluginManagerAda
>                           pter], result_adapter:Optional[Callable[[Any],Dict[s
>                           tr,Any]]]=None, supports_streaming:bool=False)

*Generic long-lived worker process that handles job execution.*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>request_queue</td>
<td>Queue</td>
<td></td>
<td>Queue for receiving job requests from parent</td>
</tr>
<tr>
<td>result_queue</td>
<td>Queue</td>
<td></td>
<td>Queue for sending job results back to parent</td>
</tr>
<tr>
<td>response_queue</td>
<td>Queue</td>
<td></td>
<td>Queue for sending command responses back to parent</td>
</tr>
<tr>
<td>plugin_manager_factory</td>
<td>Callable</td>
<td></td>
<td>Factory function that creates a plugin manager instance</td>
</tr>
<tr>
<td>result_adapter</td>
<td>Optional</td>
<td>None</td>
<td>Optional function to adapt plugin results to dict format</td>
</tr>
<tr>
<td>supports_streaming</td>
<td>bool</td>
<td>False</td>
<td>Whether this worker supports streaming execution</td>
</tr>
</tbody>
</table>

### Communication Protocol

The worker communicates with the parent process using three queues:

**Request Queue** (Parent → Worker): - `INIT`: Initialize plugin manager
with configurations - `EXECUTE`: Execute a job with specified plugin and
parameters - `RELOAD`: Reload a plugin with new configuration -
`UNLOAD`: Unload a plugin to free resources - `GET_STATE`: Query current
worker state - `STOP`: Gracefully shutdown the worker

**Result Queue** (Worker → Parent): - `READY`: Worker initialized
successfully - `RESULT`: Job execution completed (success or error) -
`STREAM_CHUNK`: Streaming output chunk - `ERROR`: Fatal worker error

**Response Queue** (Worker → Parent): - `RESPONSE`: Synchronous response
to commands (reload, unload) - `STATE`: Worker state information

### Worker Lifecycle

1.  **Initialization**: Parent sends `INIT` message with plugin
    configurations
2.  **Discovery**: Worker discovers available plugins
3.  **Loading**: Worker loads configured plugins
4.  **Execution Loop**: Worker processes `EXECUTE` requests
5.  **Shutdown**: Parent sends `STOP` or terminates the process

### Model Reuse

The worker keeps models loaded in memory between jobs. When switching
plugins, it unloads the old plugin first to free GPU memory before
loading the new one.
